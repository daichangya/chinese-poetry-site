# Poetry 新系统 — 产品文档

## 概述

Poetry 为中文诗词阅读与浏览系统（新系统），在 `poetry` 目录独立开发。内容页为**服务端渲染**，数据存于 **SQLite**；**列表与搜索**通过服务端 **API** 获取（如 GET `/api/poems?dynasty=&q=&tag=&page=&limit=`、`/api/poems/random`、`/api/dynasties`、`/api/authors`、`/api/tags`）。目标用户为诗词爱好者与普通读者，核心价值：免费阅读、排版友好、支持拼音/注释/译文/赏析、可按朝代/作者/标签浏览与检索。技术形态与栈见 [技术设计文档](tech-overview.md) 与 [数据库设计](database.md)，采用 Node/TypeScript（Next.js 动态 + SQLite + 数据脚本）。

## 用户与角色

| 角色 | 能力 |
|------|------|
| 访客 | 浏览诗词列表（默认/按朝代/标签/关键词）、查看诗词详情（正文/拼音/注释/译文/赏析）、阅读设置、朗读、全局搜索（请求 API）、浏览作者与朝代、首页推荐与随机一首；贡献指南入口（/contribute）；打印、赞赏入口与赞赏列表（P1/后续） |
| 用户 / 管理员 | **本期不实现**。若后续需要登录或管理，需接入 BaaS 或独立后端后再迭代 |

## 功能列表

与 [phase1-features-and-extensions.md](phase1-features-and-extensions.md) 对应：

| 功能 | 描述 | 角色 | 优先级 |
|------|------|------|--------|
| 诗词列表（默认/分页） | 首页进入诗词列表，按朝代/标签/关键词筛选，API 分页 | 访客 | P0 |
| 按朝代筛选诗词 | 选择朝代后请求 /api/poems?dynasty= 获取该朝代诗词 | 访客 | P0 |
| 首页推荐几首 | 请求 /api/poems/random?n= 展示约 10 首链接到详情 | 访客 | P0 |
| 随机一首 | 请求 /api/poems/random?n=1 跳转详情 | 访客 | P0 |
| 诗词详情 | 标题、正文、拼音、注释、译文、赏析；支持工整对仗等版式 | 访客 | P0 |
| 阅读设置 | 详情页内简繁、正文字体、拼音显隐、原文注解等（前端状态） | 访客 | P0 |
| 朗读 | 详情页右侧栏朗读卡片，朗读全文/停止，随简繁设置 | 访客 | P0 |
| 全局搜索 | 请求 /api/poems?q= 等，服务端查库返回匹配列表 | 访客 | P0 |
| 作者列表 | 作者列表，API 分页（/api/authors） | 访客 | P0 |
| 作者详情 | 作者信息及名下诗词列表（服务端/API 查库） | 访客 | P0 |
| 朝代维度 | 朝代列表（/api/dynasties）及该朝代下诗词/作者浏览 | 访客 | P0 |
| 打印与赞赏 | 免费打印诗词、赞赏入口与赞赏列表（静态展示） | 访客 | P1 |
| ~~注册与登录~~ | 本期不做 | — | — |
| ~~后台诗词管理~~ | 本期不做；内容更新靠 seed_db 与重新部署 | — | — |
| ~~Webhook~~ | 本期不做 | — | — |

## 界面与功能要点（当前实现）

- **首页**：标题与主 CTA（浏览诗文、随机一首、诗人、朝代）；站点统计（诗词数、作者数、朝代数）；「推荐几首」区块：请求 /api/poems/random 展示约 10 首链接到详情。
- **列表与导航**：诗词/诗人/朝代列表采用**主内容 + 左侧栏**布局；左侧栏为朝代、诗人、标签入口；详情页右侧栏：纠错与完善、阅读设置、朗读、作者信息、同朝代诗词。
- **阅读设置与朗读**：与静态方案一致，见 [poem-style.md](poem-style.md)。

## 关键业务流程

- **阅读主流程**：进入站点 → 诗词列表（或搜索/朝代/作者/标签，由 API 提供）→ 点击进入诗词详情 → 阅读正文/拼音/注释/译文/赏析，可调阅读设置 → 可选打印。
- **内容更新流程**：在本地或 CI 中运行 gen_markdown（可选）→ **seed_db**（从 .md 入库）→ 重新构建并部署或重启服务。

## 非功能需求

- **性能**：列表与搜索由 API 分页返回，避免单次拉取全量。
- **安全**：无登录与敏感接口，按需配置 HTTPS。
- **可用性**：依赖 Node 服务与 SQLite 可用性。
- **兼容性**：现代浏览器；移动端友好。

## 扩展点（后续迭代参考）

见 [phase1-features-and-extensions.md](phase1-features-and-extensions.md)：数据源为 chinese-poetry → .md → seed_db → SQLite；可扩展多数据源、增量 seed；若后续需要登录或后台，再接入 BaaS 或小型后端。
