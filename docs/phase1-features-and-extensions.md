# 阶段一：老项目分析 — 功能点与扩展点清单

基于当前 aspoem 仓库（中文诗词阅读网站）梳理，供新系统 poetry 产品文档与技术设计文档引用。

**新系统方案**：Poetry 采用**动态网站**，使用 **SQLite** 存储诗词、作者、朝代、标签。数据来源于构建时脚本：chinese-poetry → .md → **seed_db** 入库；列表、详情、搜索由服务端 API 与 lib/db 查库提供。**技术栈**为 Node/TypeScript（Next.js 动态 + seed_db），详见技术设计文档与 [database.md](database.md)。登录、后台、Webhook 本期不实现。

## 一、老项目概况

- **项目**：AsPoem，中文诗词阅读网站（aspoem.com）
- **技术栈**：Next.js 16、React 19、Prisma、PostgreSQL、tRPC、better-auth、Tailwind、shadcn/ui
- **入口与运行**：`next dev -p3333`，根路径重定向至 `/poems`
- **数据来源**：chinese-poetry 仓库经脚本生成 Markdown，再通过 `gen:markdown` / `gen:db` 入库。老项目各书脚本与数据源对应关系见 [legacy-tech-reference.md](legacy-tech-reference.md)。

## 二、模块与职责简表

| 模块       | 职责简述                         | 关键入口/接口 |
|------------|----------------------------------|---------------|
| 诗词(poem) | 诗词列表、详情、搜索、热门/最新/随机、按朝代 | tRPC poem.*, poemDiscover.* |
| 作者(author) | 作者列表、详情、按朝代筛选       | tRPC author.* |
| 朝代(dynasty) | 朝代列表、与诗词/作者关联        | tRPC dynasty.* |
| 标签(tag)  | 诗词标签，与 Poem 多对多          | 随 Poem 查询 |
| 用户/认证(auth) | 登录、注册、会话、受保护接口     | better-auth, tRPC auth.*, protected* |
| 后台(dashboard) | 诗词列表管理（表格）             | /dashboard/poems |
| 数据同步   | chinese-poetry → Markdown → DB   | scripts/gen:markdown, poems-to-db |
| Webhook    | 外部回调（如 GitHub）            | api/webhook |

## 三、功能点列表

| 编号 | 功能描述 | 角色 | 优先级 |
|------|----------|------|--------|
| F01  | 访客打开首页进入诗词列表（默认/最新） | 访客 | P0 |
| F02  | 访客按朝代筛选诗词列表，分页/游标加载 | 访客 | P0 |
| F03  | 访客查看热门诗词列表，分页/游标加载 | 访客 | P0 |
| F04  | 访客随机获取一首诗词 | 访客 | P0 |
| F05  | 访客打开诗词详情，查看标题、正文、拼音、注释、译文、赏析；访问量递增 | 访客 | P0 |
| F06  | 访客在详情页切换阅读设置（如拼音显隐、排版） | 访客 | P0 |
| F07  | 访客通过全局搜索（关键词）检索诗词 | 访客 | P0 |
| F08  | 访客浏览作者列表，支持按朝代筛选，分页/游标 | 访客 | P0 |
| F09  | 访客打开作者详情，查看作者信息及其诗词列表 | 访客 | P0 |
| F10  | 访客按朝代维度浏览（朝代列表、该朝代下诗词/作者） | 访客 | P0 |
| F11  | 用户注册、登录（better-auth），登录后可访问受保护能力 | 用户 | P0 |
| F12  | 管理员在后台查看/管理诗词列表（表格、筛选等） | 管理员 | P1 |
| F13  | 管理员在后台管理朝代等基础数据（若存在） | 管理员 | P1 |
| F14  | 通过 Webhook 触发外部集成（如同步） | 系统/运维 | P2 |
| F15  | 诗词排版支持「工整对仗」等特殊版式（isOrderliness） | 访客 | P0 |
| F16  | 免费打印诗词、赞赏与赞赏列表展示 | 访客/用户 | P1 |

## 四、扩展点列表

| 编号 | 扩展点描述 | 说明 |
|------|------------|------|
| E01  | 数据来源与同步 | 当前：chinese-poetry → .md → seed_db → SQLite；可扩展多数据源、增量 seed |
| E02  | 搜索 | 当前：服务端 API 查库（/api/poems?q=）；可扩展拼音/繁体/简繁、全文索引 |
| E03  | 排版与展示 | 当前为前端按 isOrderliness 等渲染；可扩展更多版式、字体、主题、无障碍。**新系统已实现**：朗读（Web Speech）、主题切换（四套）、贡献页 /contribute、SEO（sitemap/robots/canonical/JSON-LD）。 |
| E04  | 认证与权限 | better-auth 固定；可扩展第三方登录、角色/权限细粒度、审计日志 |
| E05  | 内容与运营 | 标签、分类、推荐策略、AI 生成（现有 ai-generator 入口）可配置化或插件化 |
| E06  | 多端与导出 | 可扩展 PWA、打印模板、导出 PDF/电子书 |
| E07  | 管理后台 | 当前仅诗词列表；可扩展作者/朝代/标签 CRUD、批量导入、操作日志 |

## 五、与阶段二文档的对应关系

- **产品文档**：功能点 F01–F16 对应产品功能列表与业务流程；扩展点 E01–E07 对应非功能或后续迭代。
- **技术设计文档**：模块表对应架构与模块划分；功能点对应接口与数据流；扩展点对应技术预留（如搜索服务、插件接口）；技术栈可选（TypeScript/Next 或 Python）。
- **测试文档**：功能点对应测试范围与用例；扩展点对应可选/后续测试范围。

---

*阶段一完成。下一步：阶段二 — 在 poetry 下产出产品文档、技术设计文档、测试文档。*
